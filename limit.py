from premium_db import has_active_premium
from usage_db import get_today_usage, log_usage
from database import get_user_language

DAILY_LIMIT = 3  # –ª–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞


def _build_limit_message(lang: str) -> str:
    if lang == "kg":
        return (
            "üö´ *–ë–∞–∑–∞–ª—ã–∫ —Ç–∞—Ä–∏—Ñ—Ç–µ –∫“Ø–Ω“Ø–Ω”© 3 —Å—É—Ä–æ–æ –ª–∏–º–∏—Ç –±–∞—Ä.*\n\n"
            "–ë“Ø–≥“Ø–Ω–∫“Ø –ª–∏–º–∏—Ç –∫–æ–ª–¥–æ–Ω—É–ª—É–ø –±“Ø—Ç—Ç“Ø.\n\n"
            "–ß–µ–∫—Å–∏–∑ —Å—É—Ä–æ–æ–ª–æ—Ä –∂–∞–Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—Ç“Ø“Ø –∂–æ–æ–ø–¥–æ—Ä “Ø—á“Ø–Ω *–ü—Ä–µ–º–∏—É–º* –∫–æ—à—Å–æ“£ –±–æ–ª–æ—Ç üöÄ\n\n"
            "üì¶ *–¢–∞—Ä–∏—Ñ—Ç–µ—Ä:*\n"
            "‚Ä¢ 1 –∞–π ‚Äî *490 —Å–æ–º*\n"
            "‚Ä¢ 6 –∞–π ‚Äî *1990 —Å–æ–º*\n"
            "‚Ä¢ 1 –∂—ã–ª ‚Äî *2990 —Å–æ–º*\n\n"
            "üßë‚Äçüíº –ê–∫—Ç–∏–≤–¥–µ—à—Ç–∏—Ä“Ø“Ø “Ø—á“Ø–Ω –º–µ–Ω–µ–¥–∂–µ—Ä–≥–µ –∂–∞–∑:\n"
            "@Artbazar_support"
        )

    if lang == "kz":
        return (
            "üö´ *–ë–∞–∑–∞–ª—ã“õ —Ç–∞—Ä–∏—Ñ—Ç–µ –∫“Ø–Ω—ñ–Ω–µ 3 —Å“±—Ä–∞“õ –ª–∏–º–∏—Ç –±–∞—Ä.*\n\n"
            "–ë“Ø–≥—ñ–Ω–≥—ñ –ª–∏–º–∏—Ç –∞—è“õ—Ç–∞–ª–¥—ã.\n\n"
            "–®–µ–∫—Å—ñ–∑ —Å“±—Ä–∞“õ—Ç–∞—Ä –º–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—Ç—ñ –∂–∞—É–∞–ø—Ç–∞—Ä “Ø—à—ñ–Ω *–ü—Ä–µ–º–∏—É–º–¥—ã* “õ–æ—Å—É“ì–∞ –±–æ–ª–∞–¥—ã üöÄ\n\n"
            "üì¶ *–¢–∞—Ä–∏—Ñ—Ç–µ—Ä:*\n"
            "‚Ä¢ 1 –∞–π ‚Äî *490 —Å–æ–º*\n"
            "‚Ä¢ 6 –∞–π ‚Äî *1990 —Å–æ–º*\n"
            "‚Ä¢ 1 –∂—ã–ª ‚Äî *2990 —Å–æ–º*\n\n"
            "üßë‚Äçüíº –ê–∫—Ç–∏–≤—Ç–µ—É “Ø—à—ñ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä–≥–µ –∂–∞–∑—ã“£—ã–∑:\n"
            "@Artbazar_support"
        )

    # ru –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    return (
        "üö´ *–õ–∏–º–∏—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ ‚Äî 3 –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å—É—Ç–∫–∏.*\n\n"
        "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –∏—Å—á–µ—Ä–ø–∞–Ω.\n\n"
        "–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, "
        "–ø–æ–¥–∫–ª—é—á–∏ *–ü—Ä–µ–º–∏—É–º* üöÄ\n\n"
        "üì¶ *–¢–∞—Ä–∏—Ñ—ã:*\n"
        "‚Ä¢ 1 –º–µ—Å—è—Ü ‚Äî *490 —Å–æ–º*\n"
        "‚Ä¢ 6 –º–µ—Å—è—Ü–µ–≤ ‚Äî *1990 —Å–æ–º*\n"
        "‚Ä¢ 1 –≥–æ–¥ ‚Äî *2990 —Å–æ–º*\n\n"
        "üßë‚Äçüíº –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–∞–ø–∏—à–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É:\n"
        "@Artbazar_support"
    )


def check_limit(user_id: int):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
      (True, None)  ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–ª–∏–º–∏—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–º–∏—É–º)
      (False, text) ‚Äî –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω, text —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """

    lang = get_user_language(user_id) or "ru"

    # –ü—Ä–µ–º–∏—É–º ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ª–æ–≥–∏—Ä—É–µ–º
    if has_active_premium(user_id):
        log_usage(user_id)
        return True, None

    used = get_today_usage(user_id)

    if used >= DAILY_LIMIT:
        msg = _build_limit_message(lang)
        return False, msg

    # –õ–∏–º–∏—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω ‚Äî —Å—á–∏—Ç–∞–µ–º –∑–∞–ø—Ä–æ—Å
    log_usage(user_id)
    return True, None
